@inject ISeminarManager SeminarManager
@page "/registerseminar"

<div class="card">
    <h1 class="card-header">Registrera seminarium</h1>
    <div class="card-body">
        <EditForm Model="CreateSeminar" OnInvalidSubmit="AddSeminar">
            <DataAnnotationsValidator />
            <div class="form-group">
                <label for="title">Titel</label>
                <InputText id="title" @bind-Value="CreateSeminar.Title" class=form-control />
                <ValidationMessage For="@(() => CreateSeminar.Title)" />
            </div>
            <div class="form-group">
                <label for="firstname">Föreläsarens förnamn</label>
                <InputText id="firstname" @bind-Value="CreateSeminar.FirstName" class=form-control />
                <ValidationMessage For="@(() => CreateSeminar.FirstName)" />
            </div>
            <div class="form-group">
                <label for="lastname">Föreläsarens efternamn</label>
                <InputText id="lastname" @bind-Value="CreateSeminar.LastName" class=form-control />
                <ValidationMessage For="@(() => CreateSeminar.LastName)" />
            </div>
            <div class="form-group">
                <label for="date">Datum</label>
                <InputDate id="date" @bind-Value="TodaysDate" class="form-control" />
                <ValidationMessage For="(() => CreateSeminar.SeminarDate)" />
            </div>
            <div class="form-group">
                <label for="time">Klockslag</label>
                <input type="time" min="08:00" max="21:00" id="time" class="form-control" @bind-value="CreateSeminar.SeminarTime" />
                <ValidationMessage For="(() => CreateSeminar.SeminarTime)" />
            </div>
            <br />
            <div>
                <MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="() => AddSeminar()">Registrera seminarium</MudButton>
            </div>
        </EditForm>
    </div>
</div>

@if (message == $"\"{CreateSeminar.Title}\" har lagts till")
{
    <MudAlert Severity="Severity.Success">@message</MudAlert>
}
else if (message == "Ett fel har uppstått. Har du fyllt i allt korrekt?")
{
    <MudAlert Severity="Severity.Error">@message</MudAlert>
}

@code {
    public List<Seminarium> AllSeminars { get; set; }
    public Seminarium CreateSeminar { get; set; } = new();
    public DateTime TodaysDate { get; set; } = DateTime.Now;
    public string message = "";

    public async Task AddSeminar()
    {
        CreateSeminar.SeminarDate = TodaysDate;
        var result = await SeminarManager.CreateSeminar(CreateSeminar);
        if (result == $"Seminariet \"{CreateSeminar.Title}\" har lagts till")
        {
            message = $"\"{CreateSeminar.Title}\" har lagts till";
        }
        else if (result == "Gick ej att lägga till seminarium")
        {
            message = "Ett fel har uppstått. Har du fyllt i allt korrekt?";
        }
    }
}
