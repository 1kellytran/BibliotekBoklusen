@page "/allproducts"
@page "/search/{searchText}"
@inject IDataManager DataManager

<NotAuthorized>
    <h3>Products</h3>
    @if (products != null)
    {
        <table class="table">
            <thead class="thead-light">
                <tr>
                    <th>Titel</th>
                    <th>Typ</th>
                    <th>Utgåva</th>
                    <th>Skapare</th>
                </tr>
            </thead>
            @foreach (var p in products)
            {
                <tr>
                    <a href="/ProductById/@p.Product.Id" class="table-bordered">@p.Product.Title</a>
                    <td>@p.Product.Type</td>
                    <td>@p.Product.PublishYear</td>
                    <td>@p.Creator.FirstName @p.Creator.LastName</td>
                    <td><a class="btn btn-warning" @onclick="() => EditProduct(p.ProductId, p)">i</a></td>
                    <td><a class="btn btn-danger" @onclick="() => DeleteProduct(p.ProductId)">x</a></td>
                </tr>
            }
        </table>
    }
</NotAuthorized>

@code {
    [Parameter]
    public int Id { get; set; }
    public List<ProductCreatorModel>? products { get; set; }
    public ProductCreatorModel? productToUpdate { get; set; }

    [Parameter]
    public string? SearchText { get; set; } = null;

    protected override async Task OnInitializedAsync()
    {
        products = await DataManager.GetAllProducts();
    }

    public async Task EditProduct(int id, ProductCreatorModel productToUpdate)
    {
        await DataManager.UpdateProduct(id, productToUpdate);
    }

    public async Task DeleteProduct(int id)
    {
        await DataManager.DeleteProduct(id);
    }

    protected override async Task OnParametersSetAsync()
    {
       if (SearchText != null)
        {
            await DataManager.SearchProducts(SearchText);
        }
        else
        {
            await DataManager.GetAllProducts();
        }
    }
}
